#!/usr/bin/env sh
# Cross-platform launcher for secrets validation.
# Tries PowerShell script first, falls back to python validator directly.
SCRIPT_DIR="$(dirname "$0")"
PS_SCRIPT="$SCRIPT_DIR/pre-commit.ps1"
PY_VALIDATOR="$(git rev-parse --show-toplevel 2>/dev/null)/scripts/python/validate_secrets.py"

run_ps() {
  pwsh -NoLogo -NoProfile -ExecutionPolicy Bypass -File "$PS_SCRIPT" 2>&1
  return $?
}

if command -v pwsh >/dev/null 2>&1 && [ -f "$PS_SCRIPT" ]; then
  run_ps
  RC=$?
  if [ $RC -eq 0 ]; then
    exit 0
  else
    echo "[pre-commit] PowerShell path failed (exit $RC), attempting python fallback..." >&2
  fi
fi

if command -v python >/dev/null 2>&1 && [ -f "$PY_VALIDATOR" ]; then
  python "$PY_VALIDATOR" || exit 1
  exit 0
fi

echo "[pre-commit] No suitable runtime (pwsh or python) with validator available." >&2
exit 1
